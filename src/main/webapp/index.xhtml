<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Transcription factor classification</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="EmulateIE8"/>
        <h:outputStylesheet name="css/screen.css"/>
    </h:head>
    <body>
        <h1>Classification of Transcription Factors in Mammalia</h1>
        #{classificationBean.init()}
    <p:panel>
        <h:form id="classificationForm">
            <div style="float:right">
                <h2><a href="about.jsf">About TFClass</a></h2>
            </div>
            <h3>Search in TFClass: <p:button value="?" title="Help" onclick="return false" id="searchHelpButton" styleClass="helpBtn"/></h3>
            <p:tooltip for="searchHelpButton"
                       value="Searches in the label, ID and external references."
                       styleClass="helpTooltip" showEvent="click"  />
            <p:autoComplete value="#{classificationBean.searchedClass}" var="cls"
                            itemValue="#{cls}" itemLabel="#{cls}"
                            completeMethod="#{classificationBean.search}"
                            scrollHeight="350" converter="ontologyClassConverter">
                <p:ajax event="itemSelect" listener="#{classificationBean.selectSearched()}"
                        update="cfTree detailsPanel" />
            </p:autoComplete>
            <p:commandButton type="submit" id="voidBtn" style="color: transparent; background-color: transparent; border-color: transparent; cursor: default;" />
            <p:defaultCommand target="voidBtn"/>
            <p>
                <a href="http://factor.genexplain.com/cgi-bin/transfac_factor/search.cgi" target="_blank">Go to the search of TRANSFAC</a></p>
            <br/><br/>

            <p:tree id="cfTree" styleClass="treePanel" value="#{classificationBean.classificationRoot}" var="node" dynamic="true" animate="true"
                    selectionMode="single" selection="#{classificationBean.selectedNode}" cache="FALSE">
                <p:ajax event="select" update="cfTree :classificationForm:detailsPanel" />
                <p:treeNode><h:outputText value="#{node.name} #{node.label}" />
                </p:treeNode>
                <p:treeNode type="Superclass"><img src="#{request.contextPath}/resources/superclass.gif" height="15px"/>
                    <h:outputText value="#{node.name} #{node.label}" />
                </p:treeNode>
                <p:treeNode type="Class"><img src="#{request.contextPath}/resources/class.gif" height="15px"/>
                    <h:outputText value="#{node.name} #{node.label}" />
                </p:treeNode>
                <p:treeNode type="Family"><img src="#{request.contextPath}/resources/family.gif" height="15px"/>
                    <h:outputText value="#{node.name} #{node.label}" />
                </p:treeNode>
                <p:treeNode type="Genus"><img src="#{request.contextPath}/resources/genus.gif" height="15px"/>
                    <h:outputText value="#{node.name} #{node.label}" />
                </p:treeNode>
                <p:treeNode type="Factor species"><img src="#{request.contextPath}/resources/fspecies.gif" height="15px"/>
                    <h:outputText value="#{node.name} #{node.label}" />
                </p:treeNode>
                <p:treeNode type="Subfamily"><img src="#{request.contextPath}/resources/subfamily.gif" height="15px"/>
                    <h:outputText value="#{node.name} #{node.label}" />
                </p:treeNode>
            </p:tree>
            <p:panel id="detailsPanel"  styleClass="detailsPanel" >
                <p:panel rendered="false">
                    Selected species:
                    <h:outputText value="Number: #{speciesSelection.getSelectedNodes()}" />
                    <p:dataList value="#{speciesSelection.getSelectedNodes()}" var="s">
                        <h:outputText value="#{s}" />
                    </p:dataList>
    <!--                <p:dataList id="selectedSpeciesList" value="#{dashboard.model.columns.get(0).getWidgets()}" var="widget"  styleClass="inlineList">
                    
                      <h:outputText value="#{speciesBean.getScientificName(widget)}" />
                  </p:dataList>   -->
                    <p:commandLink value="more"  onsuccess="speciesSelectorDlg.show();" update="speciesSelectionPanel"/>
                </p:panel>
                <p:panel id="generalReport" header="General" styleClass="reportPanel">

                    <p:outputPanel rendered="#{empty classificationBean.selectedNode}">
                     
                            <p>
                                <b>Transcription factors</b>, in a somewhat simplified definition, are
                                proteins that regulate transcription by binding to specific sequence
                                elements in regulatory genome regions such as promoters, enhancers etc.
                            </p>
                            <p>
                                <b>TFClass</b> is a classification of eukaryotic transcription factors
                                based on the characteristics of their DNA-binding domains. It comprises
                                four general levels (superclass, class, family, subfamily) and two
                                levels of instantiation (genus and molecular species). Two of them
                                (subfamily and factor species) are optional. More detailed explanations
                                about the classification scheme and its criteria are given
                                <a href="http://www.edgar-wingender.de/TFClass_schema.html" target="_blank">here.</a>.
                            </p>
                    </p:outputPanel>

                    <h:outputText value="About #{classificationBean.getAnnotationValueOfSelectedNode('label')}"
                                  styleClass="bold" rendered="#{not empty classificationBean.getAnnotationValueOfSelectedNode('about')}"/><br/>
                    <h:outputText value="#{classificationBean.getAnnotationValueOfSelectedNode('about')}" />
                    <h:outputLink value="#{classificationBean.getAnnotationValueOfSelectedNode('information')}" 
                                  rendered="#{not empty classificationBean.getAnnotationValueOfSelectedNode('information')}"> More information</h:outputLink>

                    <h:outputText value="Consensus sequence"
                                  styleClass="bold" rendered="#{not empty classificationBean.getAnnotationValueOfSelectedNode('consensus_sequence')}"/>
                    <h:outputText value="#{classificationBean.getAnnotationValueOfSelectedNode('consensus_sequence')}" />


                    <p:outputPanel rendered="#{not empty classificationBean.getAnnotationValueOfSelectedNode('seed')}">
                        <h:outputText value="Binding sites" styleClass="bold" />                      
                        <h:outputLink value="#{classificationBean.getAnnotationValueOfSelectedNode('seed')}">Seed sites</h:outputLink>
                    </p:outputPanel>
                    <p:outputPanel rendered="#{not empty classificationBean.getAnnotationValueOfSelectedNode('LOGO_plot')}">
                        <h:outputText value="LOGO plot" class="bold"/>
                        <h:outputLink value="#{classificationBean.getAnnotationValueOfSelectedNode('LOGO_definition')}" target="_blank">
                            <img src="#{classificationBean.getAnnotationValueOfSelectedNode( 'LOGO_plot')}" alt="LOGO plot" />
                        </h:outputLink>
                    </p:outputPanel>
                    <p:outputPanel rendered="#{not empty classificationBean.selectedNode}">
                        <table id="fastaTable">
                            <thead>
                                <tr>
                                    <td/>
                                    <th>DNA binding domain</th>
                                    <th>Whole protein</th>
                                </tr>
                                <tr>
                                    <th>FASTA</th>
                                    <td>
                            <h:outputLink value="/suppl/#{classificationBean.getDBDFastaForSelected()}" >FASTA file</h:outputLink></td>
                            <td> <h:outputLink value="/suppl/#{classificationBean.getFastaForSelected()}" >FASTA file</h:outputLink></td>
                            </tr>
                            <tr>
                                <th>Phylogenetic tree<br/>Mammalia</th>
                                <td>
                                    <p:dataList value="#{classificationBean.DBDSVGsForSelected}" var="svg" styleClass="inlineList">
                                <div style="position:relative; width: 200px; height: 150px;">
                                    <h:outputLink value="/suppl/#{svg}" target="_blank">
                                        <img src="/suppl/#{svg}" style="position: absolute; clip:rect(1px,10000px,10000px,50px);" alt="Phylogenetic tree"/>
                                    </h:outputLink></div>
                            </p:dataList>
                                </td>
                                <td>
                            <p:dataList value="#{classificationBean.proteinSVGsForSelected}" var="svg" styleClass="inlineList">
                                <div style="position:relative; width: 200px; height: 150px;">
                                    <h:outputLink value="/suppl/#{svg}" target="_blank">
                                        <img src="/suppl/#{svg}" style="position: absolute; clip:rect(1px,10000px,10000px,50px);" alt="Phylogenetic tree"/>
                                    </h:outputLink></div>
                            </p:dataList>
                            </td>
                            </tr>
                            <tr>
                                <th>Phylogenetic tree<br/>slim</th>
                                <td>
                                      <p:dataList value="#{classificationBean.DBDSlimSVGsForSelected}" var="svg" styleClass="inlineList">
                                <div style="position:relative; width: 200px; height: 150px;">
                                    <h:outputLink value="/suppl/#{svg}" target="_blank">
                                        <img src="/suppl/#{svg}" style="position: absolute; clip:rect(1px,10000px,10000px,50px);" alt="Phylogenetic tree"/>
                                    </h:outputLink></div>
                            </p:dataList>
                                </td>
                                <td>
                            <p:dataList value="#{classificationBean.proteinSlimSVGsForSelected}" var="svg" styleClass="inlineList">
                                <div style="position:relative; width: 200px; height: 150px;">
                                    <h:outputLink value="/suppl/#{svg}" target="_blank">
                                        <img src="/suppl/#{svg}" style="position: absolute; clip:rect(1px,10000px,10000px,50px);" alt="Phylogenetic tree"/>
                                    </h:outputLink></div>
                            </p:dataList>
                            </td>
                            </tr>
                            </thead>
                        </table>
                    </p:outputPanel>
                </p:panel>
                <p:panel rendered="#{classificationBean.selectedNode.type == 'Genus'}">
                    <h3>Species specific reports</h3>
                    Jump to <a href="#9606">human</a>, <a href="#10090">mouse</a> or <a href="#10116">rat</a><br/>
                    Hint: You can also rearrange the panels with the mouse.
                </p:panel>                
                <ui:include src="dashboard.xhtml" />
                <div style="clear:both" />

            </p:panel>
            <p:dialog widgetVar="speciesSelectorDlg" header="Select species">
                <p:ajax event="close" listener="#{speciesSelection.update()}"
                        update=":classificationForm:detailsPanel"/>
                <p:outputPanel id="speciesSelectionPanel">
                    <p>Selected the species for which a species report should be shown.</p>
                    <p:scrollPanel mode="native" style="width:500px;height:600px">
                        <p:tree value="#{speciesTree.root}" var="s" style="width: 100%"
                                selectionMode="checkbox" selection="#{speciesSelection.selectedNodes}">
                            <p:treeNode><h:outputText value="#{s.label}, #{speciesBean.getGenBankName(s.name)}" /></p:treeNode>
                        </p:tree>
                    </p:scrollPanel>
                </p:outputPanel>
            </p:dialog>
        </h:form>
    </p:panel>

</body>
</html>
