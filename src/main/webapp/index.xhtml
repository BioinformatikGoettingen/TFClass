<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Transcription factor classification</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <h:outputStylesheet name="css/screen.css"/>
    </h:head>
    <body>
        <p:ajaxStatus onstart="statusDialog.show();" onsuccess="statusDialog.hide();"/>
        <p:dialog modal="true" widgetVar="statusDialog" header="Status" showEffect="fade"
                  draggable="false" closable="false">
            Please wait ...
        </p:dialog>
        <h1>Classification of Human Transcription Factors</h1>
        <p><b>TFClass</b> is a classification of (so far: human) transcription factors
            based on the characteristics of their DNA-binding domains. It comprises
            six levels (superclasses, classes, families, subfamilies, genera and
            factor species), two of which are optional (subfamilies and factor
            species). More detailed explanations about the classification scheme and
            its criteria will be given 
            <a href="http://www.edgar-wingender.de/TFClass_schema.html">here</a>.
            The full classification can also be
            obtained 
            <a href="http://www.edgar-wingender.de/huTF_classification.html">here</a>
            as html document and as
            <a href="http://tfclass.bioinf.med.uni-goettingen.de/TFClass.obo">ontology</a> in obo-format.</p>
        <h:form id="tfForm">
            <p:panel id="additional" style="float:right">
                <h2>Search:<p:button value="?" title="Help" onclick="return false" id="searchHelpButton" styleClass="helpBtn"/></h2>
                <p:tooltip for="searchHelpButton"
                           value="Search in the labels of the ontology and select an item from the list."
                           styleClass="helpTooltip" showEvent="click"  />
                <p:autoComplete value="#{tfClassBean.searchedClass}" var="cls"
                                itemValue="#{cls}" itemLabel="#{cls}"
                                completeMethod="#{tfClassBean.search}"
                                maxResults="10" converter="ontologyClassConverter">
                    <p:ajax event="itemSelect" listener="#{tfClassBean.selectSearched()}"
                            update="tfTree" />
                </p:autoComplete>
                <p><p:commandButton value="Expand all" action="#{tfClassBean.expandAll()}" update=":tfForm:tfTree" styleClass="smallBtn"/>
                    <p:commandButton value="Collapse all" action="#{tfClassBean.collapseAll()}" update=":tfForm:tfTree"/>
                    <p:button value="?" title="Help" onclick="return false" id="expandHelpButton" styleClass="helpBtn"/>
                    <p:tooltip for="expandHelpButton" styleClass="helpTooltip" showEvent="click" >
                        <h:outputText 
                                      value="Hint: Use the context menu of a tree node to expand all it children."/>
                    </p:tooltip>
                    <p>Expand to:
                        <p:commandButton id="expandSuperClassBtn" icon="superclass-icon" styleClass="expandBtn"
                                         action="#{tfClassBean.expandToSuperClass}"
                                         update=":tfForm:tfTree" title="Expand to super class level"/>
                        <p:commandButton id="expandClassBtn" icon="class-icon" styleClass="expandBtn"
                                         action="#{tfClassBean.expandToClass}"
                                         update=":tfForm:tfTree" title="Expand do class level"/>
                        <p:commandButton id="expandFamilyBtn" icon="family-icon" styleClass="expandBtn"
                                         action="#{tfClassBean.expandToFamily}"
                                         update=":tfForm:tfTree" title="Expand to family level"/>
                        <p:commandButton id="expandSubFamilyBtn" icon="subfamily-icon" styleClass="expandBtn"
                                         action="#{tfClassBean.expandToSubfamily}"
                                         update=":tfForm:tfTree" title="Expand to subfamily level"/>
                        <p:commandButton id="expandGenusBtn" icon="genus-icon" styleClass="expandBtn"
                                         action="#{tfClassBean.expandToGenus}"
                                         update=":tfForm:tfTree" title="Expand to genus level"/>
                        <p:commandButton id="expandFSpeciesBtn" icon="fspecies-icon" styleClass="expandBtn"
                                         action="#{tfClassBean.expandToFactorSpecies}"
                                         update=":tfForm:tfTree" title="Expand to factor species level"/>
                    </p>

                </p>
                <p:tabView id="tabView" dynamic="true">

                    <p:tab id="details" title="Details">

                        <h:panelGrid columns="2" id="xrefTable">
                            <h:outputText value="ID:"/>
                            <h:outputText value="#{tfClassBean.selectedNode.data.name}" rendered="#{tfClassBean.selectedNode != null}" />
                            <h:outputText value="-" rendered="#{tfClassBean.selectedNode == null}" />
                            <h:outputText value="Definition:"/>
                            <h:outputText value="#{tfClassBean.definition}" rendered="#{tfClassBean.selectedNode != null}" escape="false"/>
                            <h:outputText value="-" rendered="#{tfClassBean.selectedNode == null}" />
                            <h:outputText value="Rank:"/>
                            <h:outputText value="#{tfClassBean.selectedNode.data.subsets}" rendered="#{tfClassBean.selectedNode != null}" />
                            <h:outputText value="-" rendered="#{tfClassBean.selectedNode == null}" />
                            <h:outputText value="ProteinAtlas:"/>
                            <h:outputText value="#{tfClassBean.proteinAtlas}" rendered="#{tfClassBean.selectedNode != null}" escape="false"/>
                            <h:outputText value="-" rendered="#{tfClassBean.selectedNode == null}" />
                            <h:outputText value="Transfac:"/>
                            <h:outputText value="#{tfClassBean.transfac}" rendered="#{tfClassBean.selectedNode != null}" escape="false"/>
                            <h:outputText value="-" rendered="#{tfClassBean.selectedNode == null}" />
                            <h:outputText value="Uniprot"/>
                            <h:outputText value="#{tfClassBean.uniprot}" rendered="#{tfClassBean.selectedNode != null}" escape="false"/>
                            <h:outputText value="-" rendered="#{tfClassBean.selectedNode == null}" />
                        </h:panelGrid>
                    </p:tab>
                    <p:tab id="expressionTab" title="Protein expression pattern">
                        The table below summarizes the protein expression data from the Protein Atlas. The tissues and cell types are
                        linked to the Cytomer ontology.
                        <p:outputPanel   rendered="#{tfClassBean.expressionTable == null}" >
                            <p>
                                <h:outputText value="The selected tree node is not linked to a gene, no expression data is available."
                                              /></p></p:outputPanel>
                        <p:dataTable id="expressionTable" 
                                     value="#{tfClassBean.getExpressionTable()}" var="row"
                                     filteredValue="#{tfClassBean.filteredTissues}">
                            <p:column sortBy="#{row.tissueClass}" filterBy="#{row.tissueClass}" filterMatchMode="contains">
                                <f:facet name="header">Tissue</f:facet>
                                <h:outputLink  value="http://cytomer.bioinf.med.uni-goettingen.de?cls=#{row.tissueClass}" title="link to Cytomer" target="_blank">
                                    <h:outputText value="#{row.tissueClass.replaceAll('_', ' ')}" />
                                </h:outputLink>
                            </p:column>

                            <p:column sortBy="#{row.cellClass}"  filterBy="#{row.cellClass}" filterMatchMode="contains">
                                <f:facet name="header">Cell type</f:facet>
                                <h:outputLink  value="http://cytomer.bioinf.med.uni-goettingen.de?cls=#{row.cellClass}" title="link to Cytomer" target="_blank">
                                    <h:outputText value="#{row.cellClass.replaceAll('_', ' ')}" /></h:outputLink>
                            </p:column>

                            <p:column sortBy="#{row.getLevelAsInt()}" filterBy="#{row.level}"  filterOptions="#{tfClassBean.getLevelOptions()}">
                                <f:facet name="header">Expression level</f:facet>#{row.level}</p:column>

                            <p:column sortBy="#{row.type}">
                                <f:facet name="header">Type</f:facet>#{row.type}</p:column>
                            <p:column sortBy="#{row.getReliabilityAsInt()}">
                                <f:facet name="header">Reliability</f:facet>#{row.reliability}</p:column>
                        </p:dataTable>
                    </p:tab> 
                </p:tabView>
            </p:panel>
            <p:panel id="ontologyPanel"><h2>Transcription factory classfication</h2>
                <p:blockUI block="tfTree" trigger=":tfForm:expandClassBtn" />
                <p>
                    Superclass:&#160;<img src="#{request.contextPath}/resources/superclass.gif" height="15px"/>,
                    Class:&#160;<img src="#{request.contextPath}/resources/class.gif" height="15px"/>,
                    Family:&#160;<img src="#{request.contextPath}/resources/family.gif" height="15px"/>,
                    Subfamily:&#160;<img src="#{request.contextPath}/resources/subfamily.gif" height="15px"/>,
                    Genus:&#160;<img src="#{request.contextPath}/resources/genus.gif" height="15px"/>,
                    Factor&#160;species:&#160;<img src="#{request.contextPath}/resources/fspecies.gif" height="15px"/></p>
                <p:contextMenu for="tfTree">
                    <p:menuitem value="Expand from here" update=":tfForm:tfTree" actionListener="#{tfClassBean.expandSelected()}" />
                </p:contextMenu>
                <p:tree id="tfTree" value="#{tfClassBean.tfRoot}" var="node" dynamic="true" animate="true"
                        selectionMode="single" selection="#{tfClassBean.selectedNode}">
                    <p:ajax event="select" update=":tfForm:tabView" />
                    <p:ajax event="collapse" listener="#{ontologyController.onNodeCollapse}" />
                    <p:treeNode><h:outputText value="#{node.name} #{node.label}" />
                    </p:treeNode>
                    <p:treeNode type="Superclass"><img src="#{request.contextPath}/resources/superclass.gif" height="15px"/>
                        <h:outputText value="#{node.name} #{node.label}" />
                    </p:treeNode>
                    <p:treeNode type="Class"><img src="#{request.contextPath}/resources/class.gif" height="15px"/>
                        <h:outputText value="#{node.name} #{node.label}" />
                    </p:treeNode>
                    <p:treeNode type="Family"><img src="#{request.contextPath}/resources/family.gif" height="15px"/>
                        <h:outputText value="#{node.name} #{node.label}" />
                    </p:treeNode>
                    <p:treeNode type="Genus"><img src="#{request.contextPath}/resources/genus.gif" height="15px"/>
                        <h:outputText value="#{node.name} #{node.label}" />
                    </p:treeNode>
                    <p:treeNode type="Factor species"><img src="#{request.contextPath}/resources/fspecies.gif" height="15px"/>
                        <h:outputText value="#{node.name} #{node.label}" />
                    </p:treeNode>
                    <p:treeNode type="Subfamily"><img src="#{request.contextPath}/resources/subfamily.gif" height="15px"/>
                        <h:outputText value="#{node.name} #{node.label}" />
                    </p:treeNode>
                </p:tree></p:panel>
        </h:form>
    </body>
</html>
